name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Build Documentation Index
        run: |
          mkdir -p _site
          
          # Copiar dashboard principal
          cp dashboard_enhanced.html _site/
          cp index.html _site/
          
          # Copiar documentaciÃ³n
          cp -r docs _site/
          
          # Crear Ã­ndice principal para GitHub Pages
          cat > _site/index.md << 'EOF'
          # ğŸ“Š Dashboard Enhanced - Documentation Hub
          
          ## ğŸ¯ Quick Navigation
          
          ### ğŸ“– Getting Started
          - [Quick Start Guide - Order & Wave](docs/guides/QUICK_START_ORDER_WAVE.md)
          - [Dashboard Application](dashboard_enhanced.html)
          
          ### ğŸ“š Documentation
          - [Technical Specifications](docs/technical/)
          - [Implementation Details](docs/implementations/)
          - [User Guides](docs/guides/)
          - [Feature Documentation](docs/features/)
          
          ### ğŸ”§ Troubleshooting & Fixes
          - [Known Issues](docs/fixes/)
          - [Problem Diagnosis](docs/fixes/TOOLTIP_DIAGNOSTIC.md)
          
          ### ğŸ“‹ Process & Audit
          - [Audit History](docs/process/audits/)
          - [Documentation Index](docs/process/documentation_index/INDEX.md)
          - [Release Notes](docs/releases/)
          
          ### ğŸ“Š Reports
          - [Executive Summaries](docs/reports/)
          
          ---
          
          ## ğŸš€ Open Dashboard
          
          **[ğŸ‘‰ Click here to open Dashboard Enhanced](dashboard_enhanced.html)**
          
          Or navigate to `/dashboard_enhanced.html`
          
          ---
          
          ## ğŸ“ Directory Structure
          
          ```
          Dashboard/
          â”œâ”€â”€ dashboard_enhanced.html        â† Main Application
          â”œâ”€â”€ index.html                     â† Landing Page
          â”œâ”€â”€ README.md                      â† Project Documentation
          â”œâ”€â”€ docs/
          â”‚   â”œâ”€â”€ guides/                    â† User Guides
          â”‚   â”œâ”€â”€ technical/                 â† Technical Specs
          â”‚   â”œâ”€â”€ implementations/           â† Implementation Details
          â”‚   â”œâ”€â”€ features/                  â† Feature Documentation
          â”‚   â”œâ”€â”€ fixes/                     â† Troubleshooting
          â”‚   â”œâ”€â”€ process/                   â† Process Documentation
          â”‚   â”œâ”€â”€ releases/                  â† Release Notes
          â”‚   â””â”€â”€ reports/                   â† Executive Reports
          â””â”€â”€ ...
          ```
          
          ---
          
          **Last Updated**: $(date)
          EOF

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '_site'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
